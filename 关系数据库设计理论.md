# 第四章 关系数据库设计理论

## 1. 数据依赖对关系模式的影响

### 数据依赖：属性值间的相互关连（主要体现于值的相等与否），是数据库模式设计的关键。

1. 通过一个关系中属性间值的相等与否体现出来的数据间的相互关系。
2. 现实世界属性间相互联系的抽象。
3. 数据内在的性质。
4. 语义的体现。

### 数据依赖的类型

1. 函数依赖(Functional Dependency, FD)
2. 多值依赖(Multivalued Dependency, MVD)

### 关系模式的简化表示

>关系模式由五部分组成，它是一个五元组：$R(U,\ D,\ Dom,\ F)$
>
>* $R$ 为关系名，它是关系的形式化表示。
>* $U$ 为组成该关系的属性组合。
>* $D$ 为属性组 $U$ 中属性所来自的域。
>* $Dom$ 为属性向域的映象的集合。
>* $F$ 为属性间数据的依赖关系集合。
>
>**PS:**  
关系模式可简化为三元组：$R(U,\ F)$  
>当且仅当 $U$ 上的一个关系 $r$ 满足 $F$ 时，$r$ 称为关系模式 $R(U,\ F)$ 的一个关系。

### 数据依赖对关系模式的影响

>**例：** 描述学校的数据库  
>
>学号(Sno)，课程名(Cname)，所在系(Sdept)，系主任(Mname)，成绩(Grade)  
>
>**学校数据库的语义**  
>
>1. 一个系有若干学生，一个学生只属于一个系。
>2. 一个系只有一名主任。
>3. 一个学生可以选修多门课程，每门课程有若干学生选修。
>4. 每个学生所学的每门课程都有一个成绩.
>
>单一的关系模式：$Student(U,\ F)$  
$U=\{Sno,\ Cname,\ Sdept,\ Mname,\ Grade\}$  
属性组 $U$ 上的一组函数依赖 $F$:  
$F=\{Sno \rightarrow Sdept,\ Sdept \rightarrow Mname,\ (Sno,\ Cname) \rightarrow Grade\}$
>
>**存在问题**  
>
>1. 数据冗余太大：浪费大量的存储空间。  
*例：每一个系主任的姓名重复出现。*
>2. 更新异常：数据冗余，更新数据时维护数据完整性代价大。  
*例：某系更换系主任后，必须修改与该系学生有关的每一个元组。*
>3. 插入异常：该插的数据插不进去。  
*例：如果一个系刚成立尚无学生，无法把这个系及其系主任信息存入数据库。*
>4. 删除异常：不该删除的数据不得不删。  
*例：如果某个系的学生全部毕业，在删除该系学生信息的同时，系及其系主任的信息也丢掉了。*
>
>**结论**  
>
>$Student$ 关系模式不是一个好的模式
>
>关系模式应做到：
>
>1. 不会发生插入异常、删除异常、更新异常。
>2. 数据冗余应尽可能少。
>
>原因：由存在于模式中的某些数据依赖引起的。  
解决办法：通过分解关系模式来消除其中不合适的数据依赖。

## 2. 关系规范化

规范化理论正是用来改造关系模式，通过分解关系模式来消除其中不合适的数据依赖，以解决插入异常、删除异常、更新异常和数据冗余问题。

### 函数依赖概念

#### 1. 函数依赖

设 $R(U)$ 是一个属性集 $U$ 上的关系模式，$X$ 和 $Y$ 是 $U$ 的子集。若对于 $R(U)$ 的任意一个可能的关系 $r$，$r$ 中不可能存在两个元组在 $X$ 上的属性值相等，而在 $Y$ 上的属性值不等，则称“$X$ 函数确定$Y$” 或 “$Y$ 函数依赖于$X$”，记作$X \rightarrow Y$；$X$ 称为这个函数依赖的决定属性集(Determinant)。

>**说明**：
>
>1. 函数依赖不是指关系模式 $R$ 的某个或某些关系实例满足的约束条件，而是指R的所有关系实例均要满足的约束条件。
>2. 函数依赖是语义范畴的概念，只能根据数据的语义来确定函数依赖。  
*例如：“姓名→年龄”这个函数依赖只有在不允许有同名人的条件下成立。*
>3. 数据库设计者可以对现实世界作强制的规定。

#### 2. 平凡函数依赖与非平凡函数依赖

在关系模式 $R(U)$ 中，对于 $U$ 的子集 $X$ 和 $Y$，如果 $X \rightarrow Y$，但 $Y \nsubseteq X$，则称 $X \rightarrow Y$ 是非平凡的函数依赖。若 $X \rightarrow Y$，但 $Y \subseteq X$，则称 $X \rightarrow Y$ 是平凡的函数依赖。

对于任一关系模式，平凡函数依赖都是必然成立的，它不反映新的语义。

#### 3. 完全函数依赖和部分函数依赖

在 $R(U)$ 中，如果 $X \rightarrow Y$，并且对于 $X$ 的任何一个真子集 $X′$，都有 $X′ \nrightarrow Y$, 则称 $Y$ 对 $X$ 完全函数依赖，记作 $X \stackrel{F}{\rightarrow} Y$。若 $X \rightarrow Y$，但 $Y$ 不完全函数依赖于 $X$，则称 $Y$ 对 $X$ 部分函数依赖，记作 $X \stackrel{P}{\rightarrow}Y$。

#### 4. 传递函数

在关系模式 $R(U)$ 中，如果 $X \rightarrow Y,\ Y \rightarrow Z$，且 $Y \nsubseteq X,\ Y \rightarrow X$，则称 $Z$ 传递函数依赖于 $X$。

### 范式

### 2NF

### 3NF

### BCNF

### 多值依赖与 4NF

### 关系规范化