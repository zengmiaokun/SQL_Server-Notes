# 第二章 关系数据库

## 1. 笛卡尔积和关系的数学定义

### 笛卡尔积

**域：** 是一组具有相同数据类型的值的集合。  
**笛卡尔积：** 给定一组域 $D_1,\ D_2\ \dots\ D_n$，这些域中可以有相同的部分，则笛卡儿积为 $D_1 \times D_2 \times \dots D_n=\{(d_1,\ d_2,\ \dots\ d_n)\ |\ d_i \in D_i,\ i=1,\ 2\ \dots\ n\}$。

>例：给出两个域  
$
\begin{aligned}
    &D_1=Name=\{Tom,\ Jerry\} \\
    &D_2=Sex=\{Male,\ Female\}
\end{aligned}
$  
则：$D_1 \times D_2=\{(Tom,\ Male),\ (Tom,\ Female),\ (Jerry,\ Male),\ (Jerry,\ Female)\}$

### 关系的数学定义

**关系(Relation)：** $D_1 \times D_2 \times \ \dots \ \times \ D_n$ 的子集叫做在域$D_1,\ D_2\ \dots \ D_n$ 上的关系。

>表示为：$R(D_1,\ D_2\ \dots \ D_n)$  
其中：  
$R：$ 关系名  
$n:$ 关系的度或目

**注意**：

* 关系是笛卡尔积的有限子集。无限关系在数据库系统中是无意义的。
* 笛卡尔积不满足交换律；关系满足交换律。

### 关系中的基本名词

**元组：** 关系表中的每一横行称作一个元组，组成元组的元素为分量。  
**属性：** 关系中的每一列称为一个属性。  
**候选码、主码、全码：** 若关系的候选码中只包含一个属性，则称它为**单属性码**；若候选码是由多个属性构成的，则称为它为**多属性码**。若关系中只有一个候选码，且这个候选码中包括全部属性，则这种候选码为**全码**。  
**主属性：** 在一个关系中，候选码中的属性称为主属性。  
**非主属性：** 不包含在任何候选码中的属性称为非主属性。

### 数据库中关系的类型

* 基本表：关系数据库中实际存在的表，是实际存储数据的逻辑表示。
* 视图表：视图表是由基本表或其他视图表导出的表。
* 查询表：查询表是指查询结果表或查询中生成的临时表。

### 数据库中基本关系的性质

1. 同一属性的数据具有同质性。
2. 同一关系的属性名具有不能重复性。
3. 关系中的列位置具有顺序无关性。
4. 关具有元组无冗余性。
5. 关系中的元组位置具有顺序无关性。
6. 关系中每一个分量都必须是不可分的数据项。

### 关系数据库

在某一应用领域中，所有实体集及实体之间联系所形成关系的集合就构成了一个**关系数据库**。

## 2. 关系模式

>关系模式的表示：$R(U,\ D,\ Dom,\ F)$
>
>* $R$为关系名，它是关系的形式化表示。
>* $U$为组成该关系的属性组合。
>* $Dom$为属性向域的映象的集合。
>* $F$为属性间数据的依赖关系集合。

## 3. 关系模型的完整性

**完整性规则：** 是对关系的某种约束条件。

* 实体完整性
* 参照完整性
* 用户定义完整性

**PS：** 实体完整性和参照完整性是关系模型必须满足的完整性约束条件，被称作是关系的**两个不变性**，一般由关系系统自动支持。

### 实体完整性

**实体完整性规则(Entity Integrity)：** 若属性 A 是基本关系 R 的主属性，则属性 A 不能取空值。

* 实体完整性能够保证实体的唯一性。
* 实体完整性能够保证实体的可区分性。

### 参照完整性

* 关系间的引用：在关系模型中实体及实体间的联系都是用关系来描述的，因此可能存在着关系与关系间的引用。
* **外码(Foreign Key)：** 设 F 是基本关系 R 的一个或一组属性，但不是关系 R 的码。如果 F 与基本关系 S 的主码 Ks 相对应，则称 F 是基本关系 R 的外码。
  * R 称为**参照关系(Referencing Relation)**；S 称为**被参照关系(Referenced Relation)**或**目标关系(Target Relation)**。
  * 关系 R 和 S 不一定是不同的关系。
  * 目标关系的 Ks 和参照关系的外码 F 必须定义在同一个（或一组）域上。
  * 外码不一定要与对应的主码同名。
  * 当外码与相应的主码属于不同关系时，往往取相同的名字，以便于识别。
* 参照完整性规则：若属性（或属性组）F 是基本关系 R 的外码，它与基本关系 S 的主码 Ks 相对应（基本关系 R 和 S 不一定是不同的关系），则对于 R 中每个元组在 F 上的值必须为：
  * 或者取空值（ F 的每个属性值均为空值）
  * 或者等于 S 中某个元组的主码值

### 用户定义的完整性

不是关系数据模型本身所要求的，而是为了满足应用方面的语义要求而提出的。

>例如：
>
>* 某个属性的值必须唯一
>* 某个属性的取值必须在某个范围内
>* 某些属性值之间应该满足一定的函数关系

在用户定义完整性中最常见的是**限定属性的取值范围**，即**对值域的约束**，所以在用户定义完整性中最常见的是域完整性约束。

## 4. 关系代数运算

### 关系操作的基本内容

* 数据查询：指数据检索、统计、排序、分组以及用户对信息的需求等功能。
* 数据维护：指数据增加、删除、修改等数据自身更新的功能。
* 数据控制：是为了保证数据的安全性和完整性而采用的数据存取控制及并发控制等功能。

关系操作的数据查询和数据维护功能使用关系代数中的**选择(Select)**、**投影(Project)**、**连接(Join)**、**除(Divide)**、**并(Union)**、**交(Intersection)**、**差(Difference)**以及**广义笛卡儿积(Extended Cartesian Product)** 8 种操作。

### 关系操作的特点

1. 关系操作语言操作一体化。
2. 关系操作的方式是一次一集合方式。
3. 关系操作语言是高度非过程化的语言。

### 关系操作语言的种类

1. [关系代数语言](https://www.cnblogs.com/lsqin/p/9342923.html "关系代数-博客园")：用对关系的运算来表达查询要求的语言。
    * 传统的集合运算
      1. 并(Union)运算：$R \cup S=\{t\ |\ t \in R\vee t \in S\}$
      2. 差(Difference)运算：$R \cup S=\{t\ |\ t \in R\land t \notin S\}$
      3. 交(Intersection)运算：$R \cup S=\{t\ |\ t \in R\land t \in S\}$
      4. 广义笛卡儿积运算：$R \times S=\{\stackrel{\frown}{\ t_r\ t_s}\ |\ t_r \in R \land t_s \in S\}$
    * 专门的关系运算
      1. 选择(Selection)运算：选择运算指在关系R中选择满足给定条件的元组。记作：$\sigma _F (R)=\{t\ |\ t \in R \land F(t)=true\}$.
      2. 投影(Projection)运算：关系 R 上的投影是从 R 中选择出若干属性列组成新的关系。记作：$\Pi _A (R)=\{t[A] \ |\ t \in R\}$.
      3. 连接(Join)运算：连接是从两个关系的笛卡儿积中选取属性间满足一定条件的元组。记作：$R \bowtie S=\{\stackrel{\frown}{\ t_r\ t_s}\ |\ t_r \in R \land t_s \in S \land t_r[A]\ \theta \ t_s[B]\}$.  
      **自然连接**是一种特殊的等值连接，它要求两个关系中进行比较的分量必须是相同的属性组，并且在结果中把重复的属性列去掉。
      1. 除(Division)运算：除法运算是一个复合的二目运算。如果把笛卡尔积看作“乘法”运算，则除法运算可以看作这个“乘法”的逆运算。记作：$R \div S=\{t_r[X]\ |\ t_r \in R \land \Pi _y (S)\subseteq Y_x \}$.  
      **计算步骤：**
         1. 将被除关系的属性分为像集属性和结果属性两部分；与除关系相同的属性属于像集属性；不相同的属性属于结果属性。
         2. 在除关系中，对像集属性投影，得到除目标数据集。
         3. 将被除关系分组。分组原则是：结果属性值一样的元组分为一组。
         4. 逐一考察每个组，如果它的像集属性值中包括目标数据集，则对应的结果属性应属于该除法运算结果集。
2. [关系演算语言](https://baike.baidu.com/item/关系演算 "关系演算-百度百科")：用查询得到的元组应满足的谓词条件来表达查询要求的语言。
   * 元组演算语言：谓词变元的基本对象是元组变量，例如 `APLHA 语言`。
   * 域演算语言：谓词变元的基本对象是域变量，例如 `QBE (Query By Example)语言`。
3. 基于映象的语言：具有关系代数和关系演算双重特点的语言，例如 `SQL 语言`。